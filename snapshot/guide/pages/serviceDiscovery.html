<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>8.2 Service Discovery 1.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/ioc.html"><strong>3</strong><span>Inversion of Control</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/config.html"><strong>4</strong><span>Application Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/dataAccess.html"><strong>10</strong><span>Configurations for Data Access</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/languageSupport.html"><strong>11</strong><span>Language Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/management.html"><strong>12</strong><span>Management &amp; Monitoring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>13</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/cli.html"><strong>14</strong><span>Micronaut CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/faq.html"><strong>15</strong><span>Frequently Asked Questions (FAQ)</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/problems.html"><strong>16</strong><span>Common Problems</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/httpClient.html">&lt;&lt; <strong>7</strong><span>The HTTP Client</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span> >></a></div>
                


                <div class="project">
                    <h1>8.2 Service Discovery</h1>

                    <p><strong>Version:</strong> 1.0.0.BUILD-SNAPSHOT</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#serviceDiscoveryConsul"><strong>8.1</strong><span>Consul Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#serviceDiscoveryEureka"><strong>8.2</strong><span>Eureka Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#serviceDiscoveryKubernetes"><strong>8.3</strong><span>Kubernetes Support</span></a>
                    </div>
                    
                </div>
                

                

<h2 id="serviceDiscovery">8.2 Service Discovery</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Service Discovery enables the ability for Microservices to find each other without necessarily knowing the physical location or IP address of associated services.</p>
</div>
<div class="paragraph">
<p>There are many ways Service Discovery can be implemented, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You could manually implement Service Discovery using DNS without requiring a third party tool or component.</p>
</li>
<li>
<p>You could use a discovery server such as <a href="https://github.com/Netflix/eureka">Eureka</a>, <a href="https://www.consul.io">Consul</a> or <a href="https://zookeeper.apache.org">ZooKeeper</a>.</p>
</li>
<li>
<p>You could delegate the work to a container runtime, such as <a href="https://kubernetes.io">Kubernetes</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With that in mind Micronaut tries to flexible to support all of these approaches. As of this writing Micronaut features integrated support for the popular Service Discovery servers Eureka and Consul.</p>
</div>
<div class="paragraph">
<p>To include Service Discovery in your application simply the first step is to add the <code>discovery-client</code> dependency to your application, for example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:discovery-client</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>discovery-client</code> dependency provides implementations of the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> interface.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> is fairly simple and provides two main entry points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/discovery/DiscoveryClient.html#getServiceIds--">DiscoveryClient.getServiceIds()</a> - Returns all discovered service IDs</p>
</li>
<li>
<p><a href="../api/io/micronaut/discovery/DiscoveryClient.html#getInstances-java.lang.String-">DiscoveryClient.getInstances(java.lang.String)</a> - Returns all the <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> objects for a given service ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both methods return <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> instances since the operation to retrieve service ID information may result in a blocking network call depending on the underlying implementation.</p>
</div>
<div class="paragraph">
<p>The default implementation of the <code>DiscoveryClient</code> interface is <a href="../api/io/micronaut/discovery/client/CachingCompositeDiscoveryClient.html">CachingCompositeDiscoveryClient</a> which merges all other <code>DiscoveryClient</code> beans into a single bean and provides caching of the results of the methods. The default behaviour is to cache for 30 seconds. This cache can be disabled in application configuration:</p>
</div>
<div class="listingblock">
<div class="title">Disabling the Discovery Client Cache</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">caches</span>:
        <span class="key">discovery-client</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can alter the cache&#8217;s expiration policy:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Discovery Client Cache</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">caches</span>:
        <span class="key">discovery-client</span>:
            <span class="key">expireAfterAccess</span>: <span class="string"><span class="content">60s</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="../api/io/micronaut/discovery/client/DiscoveryClientCacheConfiguration.html">DiscoveryClientCacheConfiguration</a> class for available configuration options.</p>
</div>


<h2 id="serviceDiscoveryConsul">8.2.1 Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.consul.io">Consul</a> is a popular Service Discovery and Distributed Configuration server provided by HashiCorp. Micronaut features a native non-blocking <a href="../api/io/micronaut/discovery/consul/client/v1/ConsulClient.html">ConsulClient</a> that is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_consul">Starting Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start using Consul is via Docker:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starting Consul with Docker</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.consul.io/docs/install/index.html">install and run a local Consul instance</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auto_registering_with_consul">Auto Registering with Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register a Micronaut application with Consul simply add the necessary <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a>. A minimal example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Consul (application.yml)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the Micronaut CLI you can quickly create a new service setup with Consul using: <code>mn create-app my-app -features discovery-consul</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>consul.client.defaultZone</code> settings accepts a list of Consul servers to be used by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You could also simply set <code>consul.client.host</code> and <code>consul.client.port</code>, however <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a> allows you specify per zone discovery services for the purpose load balancing. A zone maps onto a AWS availability zone or a Google Cloud zone.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default registering with Consul is disabled hence you should set <code>consul.client.registration.enabled</code> to <code>true</code>. Note that you may wish to do this only in your production configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_consul_service_registration">Customizing Consul Service Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a> class features a range of customization options for altering how an instance registers with Consul. You can customize the tags, the retry attempts, the fail fast behaviour and so on.</p>
</div>
<div class="paragraph">
<p>Notice too that <code>ConsulConfiguration</code> extends <a href="../api/io/micronaut/discovery/client/DiscoveryClientConfiguration.html">DiscoveryClientConfiguration</a>  which in turn extends <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> allowing you to customize the settings for the Consul client, including read timeout, proxy configuration and so on.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Consul Registration Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="comment"># Alters the tags</span>
      <span class="key">tags</span>:
        - <span class="string"><span class="content">hello</span></span>
        - <span class="string"><span class="content">world</span></span>
      <span class="comment"># Alters the retry count</span>
      <span class="key">retry-count</span>: <span class="string"><span class="content">5</span></span>
      <span class="comment"># Alters fail fast behaviour</span>
      <span class="key">fail-fast</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_discovery_services_from_consul">Discovery Services from Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To discovery other services you could manually interact with the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a>, however typically instead you use the <a href="#clientAnnotation">Client Annotation</a> to declare how an HTTP client maps to a service.</p>
</div>
<div class="paragraph">
<p>For example the configuration in the previous section declared a value for <code>micronaut.application.name</code> of <code>hello-world</code>. This is the value that will be used as the service ID when registering with Consul.</p>
</div>
<div class="paragraph">
<p>Other services can discovery instances of the <code>hello-world</code> service simply by declaring a client as follows:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> <span class="class">HelloClient</span>{
        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can also use <a href="../api/io/micronaut/http/client/Client.html">@Client</a> as a qualifier to <code>@Inject</code> an instance of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a>:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Inject</span>
RxHttpClient httpClient;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consul_health_checks">Consul Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default when registering with Consul Micronaut will register a <a href="https://www.consul.io/docs/agent/checks.html">TTL check</a>. A TTL check basically means that if the application does not send a heartbeat back to Consul after a period of time the service is put in a failing state.</p>
</div>
<div class="paragraph">
<p>Micronaut applications feature a <a href="../api/io/micronaut/health/HeartbeatConfiguration.html">HeartbeatConfiguration</a> which starts a thread using <a href="../api/io/micronaut/health/HeartbeatTask.html">HeartbeatTask</a> that fires <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/consul/registration/ConsulAutoRegistration.html">ConsulAutoRegistration</a> class listens for these events and sends a callback to the <a href="https://www.consul.io/api/agent/check.html">/agent/check/pass/:check_id</a> endpoint provided by Consul, effectively keeping the service alive.</p>
</div>
<div class="paragraph">
<p>With this arrangement the responsibility is on the Micronaut application to send TTL callbacks to Consul on a regular basis.</p>
</div>
<div class="paragraph">
<p>If you prefer you can push the responsibility for health checks to Consul itself by registering an HTTP check:</p>
</div>
<div class="listingblock">
<div class="title">Consul HTTP Check Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
       <span class="key">check</span>:
          <span class="key">http</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration option in place Consul will assume responsibility of invoking the Micronaut applications <a href="#healthEndpoint">Health Endpoint</a>.</p>
</div>
</div>
</div>


<h2 id="serviceDiscoveryEureka">8.2.2 Eureka Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryEureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/Netflix/eureka">Netflix Eureka</a> is a popular discovery server deployed at scale at organizations like Netflix.</p>
</div>
<div class="paragraph">
<p>Micronaut features a native non-blocking <a href="../api/io/micronaut/discovery/eureka/client/v2/EurekaClient.html">EurekaClient</a> as part of the <code>discovery-client</code> module that does not require any additional third-party dependencies and is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_eureka">Starting Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start a Eureka server is to use to use <a href="https://spring.io/guides/gs/service-registration-and-discovery/#initial">Spring Boot&#8217;s Eureka starters</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of this writing the Docker images for Eureka are significantly out-of-date so it is recommended to create a Eureka server following the steps above.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auto_registering_with_eureka">Auto Registering with Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process to register a Micronaut application with Eureka is very similar to with Consul, as seen in the previous section, simply add the necessary <a href="../api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>. A minimal example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Eureka (application.yml)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">eureka</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_service_registration">Customizing Service Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize various aspects of registration with Eureka using the <a href="../api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>. Notice that <code>EurekaConfiguration</code> extends <a href="../api/io/micronaut/discovery/client/DiscoveryClientConfiguration.html">DiscoveryClientConfiguration</a>  which in turn extends <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> allowing you to customize the settings for the Eureka client, including read timeout, proxy configuration and so on.</p>
</div>
<div class="listingblock">
<div class="title">Example Eureka Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eureka</span>:
  <span class="key">client</span>:
     <span class="key">readTimeout</span>: <span class="string"><span class="content">5s</span></span>
     <span class="key">registration</span>:
         <span class="key">asgName</span>: <span class="string"><span class="content">myAsg</span></span> <span class="comment"># the auto scaling group name</span>
         <span class="key">countryId</span>: <span class="string"><span class="content">10</span></span> <span class="comment"># the country id</span>
         <span class="key">vipAddress</span>: <span class="string"><span class="content">'myapp'</span></span> <span class="comment"># The Eureka VIP address</span>
         <span class="key">leaseInfo</span>:
            <span class="key">durationInSecs</span>: <span class="string"><span class="content">60</span></span> <span class="comment"># The lease information</span>
         <span class="key">metadata</span>: <span class="comment"># arbitrary instance metadata</span>
            <span class="key">foo</span>: <span class="string"><span class="content">bar</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eureka_basic_authentication">Eureka Basic Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize the Eureka credentials in the URI you specify to in <code>defaultZone</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Eureka</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eureka</span>:
  <span class="key">client</span>:
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://${EUREKA_USERNAME}:${EUREKA_PASSWORD}@localhost:8761</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example externalizes configuration of the username and password Eureka to environment variables called <code>EUREKA_USERNAME</code> and <code>EUREKA_PASSWORD</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eureka_health_checks">Eureka Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like Consul, the <a href="../api/io/micronaut/discovery/eureka/registration/EurekaAutoRegistration.html">EurekaAutoRegistration</a> will send <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances with the <a href="../api/io/micronaut/health/HealthStatus.html">HealthStatus</a> of the Micronaut application to Eureka.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/health/monitor/HealthMonitorTask.html">HealthMonitorTask</a> will by default continuously monitor the <a href="../api/io/micronaut/health/HealthStatus.html">HealthStatus</a> of the application by running health checks and the <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> will be sent to Eureka.</p>
</div>
</div>
</div>


<h2 id="serviceDiscoveryKubernetes">8.2.3 Kubernetes Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryKubernetes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Kubernetes is a container runtime which has a whole bunch of features including integrated Service Discovery. The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#environment-variables">strategy for Service Discovery in Kubernetes</a> is pretty simple in that for each Pod, Kubernetes will expose environment variables in the format <code>[SERVICE_NAME]_SERVICE_HOST</code> and <code>[SERVICE_NAME]_SERVICE_PORT</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut features a <a href="../api/io/micronaut/discovery/kubernetes/KubernetesDiscoveryClient.html">KubernetesDiscoveryClient</a> that simply looks at the environment variables and translates those into the available services.</p>
</div>
<div class="paragraph">
<p>For example given a service exposed as <code>HELLO_WORLD_SERVICE_HOST</code> to your application, you can declare clients that will be automatically discovered using:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> <span class="class">HelloClient</span>{
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Kubernetes itself assumes responsibility for tasks such as health checks, load balancing and so on there is no need to send <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances and so on.</p>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/httpClient.html">&lt;&lt; <strong>7</strong><span>The HTTP Client</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
