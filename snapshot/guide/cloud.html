<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>8 Cloud Native Features 1.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/ioc.html"><strong>3</strong><span>Inversion of Control</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/config.html"><strong>4</strong><span>Application Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/dataAccess.html"><strong>10</strong><span>Configurations for Data Access</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/languageSupport.html"><strong>11</strong><span>Language Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/management.html"><strong>12</strong><span>Management &amp; Monitoring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>13</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cli.html"><strong>14</strong><span>Micronaut CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/faq.html"><strong>15</strong><span>Frequently Asked Questions (FAQ)</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/problems.html"><strong>16</strong><span>Common Problems</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/httpClient.html">&lt;&lt; <strong>7</strong><span>The HTTP Client</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span> >></a></div>
                


                <div class="project">
                    <h1>8 Cloud Native Features</h1>

                    <p><strong>Version:</strong> 1.0.0.BUILD-SNAPSHOT</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#cloudConfiguration"><strong>8.1</strong><span>Cloud Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#distributedConfiguration"><strong>8.1.1</strong><span>Distributed Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#distributedConfigurationConsul"><strong>8.1.2</strong><span>Consul Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#serviceDiscovery"><strong>8.2</strong><span>Service Discovery</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#serviceDiscoveryConsul"><strong>8.2.1</strong><span>Consul Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#serviceDiscoveryEureka"><strong>8.2.2</strong><span>Eureka Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#serviceDiscoveryKubernetes"><strong>8.2.3</strong><span>Kubernetes Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#clientSideLoadBalancing"><strong>8.3</strong><span>Client Side Load Balancing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#netflixRibbon"><strong>8.3.1</strong><span>Netflix Ribbon Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#distributedTracing"><strong>8.4</strong><span>Distributed Tracing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#zipkin"><strong>8.4.1</strong><span>Tracing with Zipkin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#jaeger"><strong>8.4.2</strong><span>Tracing with Jaeger</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="cloud">8 Cloud Native Features</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The majority of frameworks in use on the JVM were designed at a time when the Cloud and Microservices didn&#8217;t exist and hence are filled with legacy, consume more memory due to being designed to run on traditional Java containers and include Cloud support as an add-on.</p>
</div>
<div class="paragraph">
<p>Micronaut is designed from the ground-up for building Microservices for the Cloud. In other words Micronaut truly embraces the industries current favorite buzzword: Cloud Native.</p>
</div>
<div class="paragraph">
<p>Integrated directly into the runtime is support for features such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributed Configuration</p>
</li>
<li>
<p>Service Discovery</p>
</li>
<li>
<p>Client Side Load Balancing</p>
</li>
<li>
<p>Distributed Tracing</p>
</li>
<li>
<p>Serverless Functions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many of the features in Micronaut and heavily inspired by features from Spring and Grails. This is by design and helps developers who are already familiar with systems such as Spring Cloud.</p>
</div>
<div class="paragraph">
<p>The following sections cover these features and how to use them.</p>
</div>


<h2 id="cloudConfiguration">8.1 Cloud Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/cloudConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Applications that are built for the Cloud often need adapt to running in a Cloud environment, read and share configuration in a distributed manner and externalize configuration to the environment where necessary.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="#environments">Environment</a> concept is by default Cloud platform aware and will make a best effort to detect the underlying active environment.</p>
</div>
<div class="paragraph">
<p>You can then use the <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a> annotation to <a href="#conditionalBeans">conditionally load bean definitions</a>.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the constants provided by the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Environment Detection</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Constant</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requires Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#ANDROID">ANDROID</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running as an Android application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.ANDROID)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#TEST">TEST</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running within a JUnit or Spock test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.TEST)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#CLOUD">CLOUD</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running in a Cloud environment (present for all other cloud platform types)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.CLOUD)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#AMAZON_EC2">AMAZON_EC2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://aws.amazon.com/ec2">Amazon EC2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.AMAZON_EC2)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#GOOGLE_COMPUTE">GOOGLE_COMPUTE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://cloud.google.com/compute/">Google Compute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.GOOGLE_COMPUTE)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#KUBERNETES">KUBERNETES</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.kubernetes.io">Kubernetes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.KUBERNETES)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#HEROKU">HEROKU</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://heroku.com">Heroku</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.HEROKU)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#CLOUD_FOUNDRY">CLOUD_FOUNDRY</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.cloudfoundry.org">Cloud Foundry</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.CLOUD_FOUNDRY)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#AZURE">AZURE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://azure.microsoft.com">Microsoft Azure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.AZURE)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#IBM">IBM</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.ibm.com/cloud/">IBM Cloud</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.IBM)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that it may be that case that you have multiple active environment names since you may run Kubernetes on AWS for example.</p>
</div>
<div class="paragraph">
<p>In addition, using the value of the constants defined in the table above you can create environment specific configuration files. For example if you create a <code>src/main/resources/application-gcp.yml</code> file then that configuration will only be loaded when running on Google Compute.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Any configuration property in the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> can also be set via an environment variable. For example, setting the <code>CONSUL_CLIENT_HOST</code> environment variable will override the <code>host</code> property in <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_using_cloud_instance_metadata">Using Cloud Instance Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Micronaut detects it is running on Google Compute or AWS EC2, upon startup Micronaut will populate the interface <a href="../api/io/micronaut/discovery/cloud/ComputeInstanceMetadata.html">ComputeInstanceMetadata</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Depending the environment you are running in the backing implementation will be either <a href="../api/io/micronaut/discovery/cloud/gcp/GoogleComputeInstanceMetadata.html">GoogleComputeInstanceMetadata</a> or <a href="../api/io/micronaut/discovery/cloud/aws/AmazonEC2InstanceMetadata.html">AmazonEC2InstanceMetadata</a> with metadata found from Google or Amazon&#8217;s metadata services.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All of this data is merged together into the <code>metadata</code> property for the running <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>If you need to access the metadata for your application instance you can use the interface <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a>, and call <code>getMetadata()</code> which will get a map of all of the metadata.</p>
</div>
<div class="paragraph">
<p>If you are connecting remotely via client, the instance metadata can be referenced once you have retrieved a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> from either the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> or <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> APIs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Netflix Ribbon client side load balancer can be configured to use the metadata to do zone aware client side load balancing. See <a href="#clientSideLoadBalancing">Client Side Load Balancing</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To obtain metadata for a service via <a href="#serviceDiscovery">Service Discovery</a> use the <a href="../api/io/micronaut/http/client/LoadBalancerResolver.html">LoadBalancerResolver</a> interface to resolve a <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> and obtain a reference to a service by identifier:</p>
</div>
<div class="listingblock">
<div class="title">Obtaining Metadata for a Service instance</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">LoadBalancer loadBalancer = loadBalancerResolver.resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">some-service</span><span class="delimiter">&quot;</span></span>);
Flowable.fromPublisher(
    loadBalancer.select()
).subscribe((instance) -&gt;
    ConvertibleValues&lt;<span class="predefined-type">String</span>&gt; metaData = instance.getMetadata();
    ...
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To obtain metadata for the locally running server use the <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a> interface:</p>
</div>
<div class="listingblock">
<div class="title">Obtaining Metadata for a Local Server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EmbeddedServerInstance serverInstance = applicationContext.getBean(EmbeddedServerInstance.class);
ConvertibleValues&lt;<span class="predefined-type">String</span>&gt; metaData = serverInstance.getMetadata();</code></pre>
</div>
</div>
</div>
</div>


<h2 id="distributedConfiguration">8.1.1 Distributed Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/cloudConfiguration/distributedConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As you can see, Micronaut features a robust system for externalizing and adapting configuration to the environment inspired by similar approaches found in Grails and Spring Boot.</p>
</div>
<div class="paragraph">
<p>However, what if you want two Microservices to share configuration? Micronaut comes with built in APIs for doing distributed configuration.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/config/ConfigurationClient.html">ConfigurationClient</a> interface has a single method called <code>getPropertySources</code> that can be implemented to read and resolve configuration from distributed sources.</p>
</div>
<div class="paragraph">
<p>The <code>getPropertySources</code> returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits zero or many <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances.</p>
</div>
<div class="paragraph">
<p>The default implementation is <a href="../api/io/micronaut/discovery/config/DefaultCompositeConfigurationClient.html">DefaultCompositeConfigurationClient</a> which merges all registered <code>ConfigurationClient</code> beans into a single bean.</p>
</div>
<div class="paragraph">
<p>You can either implement your own <a href="../api/io/micronaut/discovery/config/ConfigurationClient.html">ConfigurationClient</a> implementation or you can use one of the ones already built into Micronaut. The following sections cover those.</p>
</div>


<h2 id="distributedConfigurationConsul">8.1.2 Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.consul.io">Consul</a> is a popular Service Discovery and Distributed Configuration server provided by HashiCorp. Micronaut features a native <a href="../api/io/micronaut/discovery/consul/client/v1/ConsulClient.html">ConsulClient</a> that is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_consul">Starting Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start using Consul is via Docker:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starting Consul with Docker</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.consul.io/docs/install/index.html">install and run a local Consul instance</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_distributed_configuration_with_consul">Enabling Distributed Configuration with Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable distributed configuration, similar to Spring Boot and Grails, you need to create a <code>src/main/resources/bootstrap.yml</code> configuration file and configure Consul as well as enable the configuration client:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
    <span class="key">config-client</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
<span class="key">consul</span>:
    <span class="key">client</span>:
        <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have enabled distributed configuration you need to store the configuration you wish the share in Consul&#8217;s Key/Value store.</p>
</div>
<div class="paragraph">
<p>There are a number of different ways to do that.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_as_key_value_pairs">Storing Configuration as Key/Value Pairs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One way is to store each key and value directly in Consul. In this case by default Micronaut will look for configuration in the <code>/config</code> folder of Consul.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can alter the path searched for by setting <code>consul.client.config.path</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Within the <code>/config</code> folder Micronaut will search values within the following folders in order of precedence:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Resolution Precedence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Folder</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application,prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications for the <code>prod</code> <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration, example <code>/config/hello-world</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME],prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration for an active <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The value of <code>APPLICATION_NAME</code> is whatever your have configured <code>micronaut.application.name</code> to be in <code>bootstrap.yml</code>.</p>
</div>
<div class="paragraph">
<p>To see this in action use the following curl command to store a property called <code>foo.bar</code> with a value of <code>myvalue</code> in the folder <code>/config/application</code>.</p>
</div>
<div class="listingblock">
<div class="title">Using curl to Write a Value</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X PUT -d @- localhost:8500/v1/kv/config/application/foo.bar &lt;&lt;&lt; myvalue</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you know define a <code>@Value("${foo.bar}")</code> or call <code>environment.getProperty(..)</code> the value <code>myvalue</code> will be resolved from Consul.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_in_yaml_json_etc">Storing Configuration in YAML, JSON etc.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some Consul users prefer storing configuration in blobs of a certain format, such as YAML. Micronaut supports this mode and supports storing configuration in either YAML, JSON or Java properties format.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/discovery/config/ConfigDiscoveryConfiguration.html">ConfigDiscoveryConfiguration</a> has a number of configuration options for configuring how distributed configuration is discovered.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can set the <code>consul.client.config.format</code> option to configure the format with which properties are read.</p>
</div>
<div class="paragraph">
<p>For example, to configure JSON:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">consul</span>:
    <span class="key">client</span>:
        <span class="key">config</span>:
            <span class="key">format</span>: <span class="string"><span class="content">JSON</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now write your configuration in JSON format to Consul:</p>
</div>
<div class="listingblock">
<div class="title">Using curl write JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X PUT  localhost:8500/v1/kv/config/application \
-d @- &lt;&lt; EOF
{ &quot;foo&quot;: {  &quot;bar&quot;: &quot;myvalue&quot; } }
EOF</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_as_file_references">Storing Configuration as File References</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another option popular option is <a href="https://github.com/breser/git2consul">git2consul</a> which mirrors the contents of a Git repository to Consul&#8217;s Key/Value store.</p>
</div>
<div class="paragraph">
<p>You can setup a Git repository that contains files like <code>application.yml</code>, <code>hello-world-test.json</code> etc. and the contents of these files are cloned to Consul.</p>
</div>
<div class="paragraph">
<p>In this case each key in consul represents a file with an extension. For example <code>/config/application.yml</code> and you must configure the <code>FILES</code> format:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">consul</span>:
    <span class="key">client</span>:
        <span class="key">config</span>:
            <span class="key">format</span>: <span class="string"><span class="content">FILES</span></span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="serviceDiscovery">8.2 Service Discovery</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Service Discovery enables the ability for Microservices to find each other without necessarily knowing the physical location or IP address of associated services.</p>
</div>
<div class="paragraph">
<p>There are many ways Service Discovery can be implemented, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You could manually implement Service Discovery using DNS without requiring a third party tool or component.</p>
</li>
<li>
<p>You could use a discovery server such as <a href="https://github.com/Netflix/eureka">Eureka</a>, <a href="https://www.consul.io">Consul</a> or <a href="https://zookeeper.apache.org">ZooKeeper</a>.</p>
</li>
<li>
<p>You could delegate the work to a container runtime, such as <a href="https://kubernetes.io">Kubernetes</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With that in mind Micronaut tries to flexible to support all of these approaches. As of this writing Micronaut features integrated support for the popular Service Discovery servers Eureka and Consul.</p>
</div>
<div class="paragraph">
<p>To include Service Discovery in your application simply the first step is to add the <code>discovery-client</code> dependency to your application, for example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:discovery-client</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>discovery-client</code> dependency provides implementations of the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> interface.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> is fairly simple and provides two main entry points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/discovery/DiscoveryClient.html#getServiceIds--">DiscoveryClient.getServiceIds()</a> - Returns all discovered service IDs</p>
</li>
<li>
<p><a href="../api/io/micronaut/discovery/DiscoveryClient.html#getInstances-java.lang.String-">DiscoveryClient.getInstances(java.lang.String)</a> - Returns all the <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> objects for a given service ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both methods return <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> instances since the operation to retrieve service ID information may result in a blocking network call depending on the underlying implementation.</p>
</div>
<div class="paragraph">
<p>The default implementation of the <code>DiscoveryClient</code> interface is <a href="../api/io/micronaut/discovery/client/CachingCompositeDiscoveryClient.html">CachingCompositeDiscoveryClient</a> which merges all other <code>DiscoveryClient</code> beans into a single bean and provides caching of the results of the methods. The default behaviour is to cache for 30 seconds. This cache can be disabled in application configuration:</p>
</div>
<div class="listingblock">
<div class="title">Disabling the Discovery Client Cache</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">caches</span>:
        <span class="key">discovery-client</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can alter the cache&#8217;s expiration policy:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Discovery Client Cache</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">caches</span>:
        <span class="key">discovery-client</span>:
            <span class="key">expireAfterAccess</span>: <span class="string"><span class="content">60s</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="../api/io/micronaut/discovery/client/DiscoveryClientCacheConfiguration.html">DiscoveryClientCacheConfiguration</a> class for available configuration options.</p>
</div>


<h2 id="serviceDiscoveryConsul">8.2.1 Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.consul.io">Consul</a> is a popular Service Discovery and Distributed Configuration server provided by HashiCorp. Micronaut features a native non-blocking <a href="../api/io/micronaut/discovery/consul/client/v1/ConsulClient.html">ConsulClient</a> that is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_consul">Starting Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start using Consul is via Docker:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starting Consul with Docker</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.consul.io/docs/install/index.html">install and run a local Consul instance</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auto_registering_with_consul">Auto Registering with Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register a Micronaut application with Consul simply add the necessary <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a>. A minimal example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Consul (application.yml)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the Micronaut CLI you can quickly create a new service setup with Consul using: <code>mn create-app my-app -features discovery-consul</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>consul.client.defaultZone</code> settings accepts a list of Consul servers to be used by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You could also simply set <code>consul.client.host</code> and <code>consul.client.port</code>, however <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a> allows you specify per zone discovery services for the purpose load balancing. A zone maps onto a AWS availability zone or a Google Cloud zone.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default registering with Consul is disabled hence you should set <code>consul.client.registration.enabled</code> to <code>true</code>. Note that you may wish to do this only in your production configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_consul_service_registration">Customizing Consul Service Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a> class features a range of customization options for altering how an instance registers with Consul. You can customize the tags, the retry attempts, the fail fast behaviour and so on.</p>
</div>
<div class="paragraph">
<p>Notice too that <code>ConsulConfiguration</code> extends <a href="../api/io/micronaut/discovery/client/DiscoveryClientConfiguration.html">DiscoveryClientConfiguration</a>  which in turn extends <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> allowing you to customize the settings for the Consul client, including read timeout, proxy configuration and so on.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Consul Registration Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="comment"># Alters the tags</span>
      <span class="key">tags</span>:
        - <span class="string"><span class="content">hello</span></span>
        - <span class="string"><span class="content">world</span></span>
      <span class="comment"># Alters the retry count</span>
      <span class="key">retry-count</span>: <span class="string"><span class="content">5</span></span>
      <span class="comment"># Alters fail fast behaviour</span>
      <span class="key">fail-fast</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_discovery_services_from_consul">Discovery Services from Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To discovery other services you could manually interact with the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a>, however typically instead you use the <a href="#clientAnnotation">Client Annotation</a> to declare how an HTTP client maps to a service.</p>
</div>
<div class="paragraph">
<p>For example the configuration in the previous section declared a value for <code>micronaut.application.name</code> of <code>hello-world</code>. This is the value that will be used as the service ID when registering with Consul.</p>
</div>
<div class="paragraph">
<p>Other services can discovery instances of the <code>hello-world</code> service simply by declaring a client as follows:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> <span class="class">HelloClient</span>{
        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can also use <a href="../api/io/micronaut/http/client/Client.html">@Client</a> as a qualifier to <code>@Inject</code> an instance of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a>:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Inject</span>
RxHttpClient httpClient;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consul_health_checks">Consul Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default when registering with Consul Micronaut will register a <a href="https://www.consul.io/docs/agent/checks.html">TTL check</a>. A TTL check basically means that if the application does not send a heartbeat back to Consul after a period of time the service is put in a failing state.</p>
</div>
<div class="paragraph">
<p>Micronaut applications feature a <a href="../api/io/micronaut/health/HeartbeatConfiguration.html">HeartbeatConfiguration</a> which starts a thread using <a href="../api/io/micronaut/health/HeartbeatTask.html">HeartbeatTask</a> that fires <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/consul/registration/ConsulAutoRegistration.html">ConsulAutoRegistration</a> class listens for these events and sends a callback to the <a href="https://www.consul.io/api/agent/check.html">/agent/check/pass/:check_id</a> endpoint provided by Consul, effectively keeping the service alive.</p>
</div>
<div class="paragraph">
<p>With this arrangement the responsibility is on the Micronaut application to send TTL callbacks to Consul on a regular basis.</p>
</div>
<div class="paragraph">
<p>If you prefer you can push the responsibility for health checks to Consul itself by registering an HTTP check:</p>
</div>
<div class="listingblock">
<div class="title">Consul HTTP Check Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
       <span class="key">check</span>:
          <span class="key">http</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration option in place Consul will assume responsibility of invoking the Micronaut applications <a href="#healthEndpoint">Health Endpoint</a>.</p>
</div>
</div>
</div>


<h2 id="serviceDiscoveryEureka">8.2.2 Eureka Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryEureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/Netflix/eureka">Netflix Eureka</a> is a popular discovery server deployed at scale at organizations like Netflix.</p>
</div>
<div class="paragraph">
<p>Micronaut features a native non-blocking <a href="../api/io/micronaut/discovery/eureka/client/v2/EurekaClient.html">EurekaClient</a> as part of the <code>discovery-client</code> module that does not require any additional third-party dependencies and is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_eureka">Starting Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start a Eureka server is to use to use <a href="https://spring.io/guides/gs/service-registration-and-discovery/#initial">Spring Boot&#8217;s Eureka starters</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of this writing the Docker images for Eureka are significantly out-of-date so it is recommended to create a Eureka server following the steps above.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auto_registering_with_eureka">Auto Registering with Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process to register a Micronaut application with Eureka is very similar to with Consul, as seen in the previous section, simply add the necessary <a href="../api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>. A minimal example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Eureka (application.yml)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">eureka</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_service_registration">Customizing Service Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize various aspects of registration with Eureka using the <a href="../api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>. Notice that <code>EurekaConfiguration</code> extends <a href="../api/io/micronaut/discovery/client/DiscoveryClientConfiguration.html">DiscoveryClientConfiguration</a>  which in turn extends <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> allowing you to customize the settings for the Eureka client, including read timeout, proxy configuration and so on.</p>
</div>
<div class="listingblock">
<div class="title">Example Eureka Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eureka</span>:
  <span class="key">client</span>:
     <span class="key">readTimeout</span>: <span class="string"><span class="content">5s</span></span>
     <span class="key">registration</span>:
         <span class="key">asgName</span>: <span class="string"><span class="content">myAsg</span></span> <span class="comment"># the auto scaling group name</span>
         <span class="key">countryId</span>: <span class="string"><span class="content">10</span></span> <span class="comment"># the country id</span>
         <span class="key">vipAddress</span>: <span class="string"><span class="content">'myapp'</span></span> <span class="comment"># The Eureka VIP address</span>
         <span class="key">leaseInfo</span>:
            <span class="key">durationInSecs</span>: <span class="string"><span class="content">60</span></span> <span class="comment"># The lease information</span>
         <span class="key">metadata</span>: <span class="comment"># arbitrary instance metadata</span>
            <span class="key">foo</span>: <span class="string"><span class="content">bar</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eureka_basic_authentication">Eureka Basic Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize the Eureka credentials in the URI you specify to in <code>defaultZone</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Eureka</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eureka</span>:
  <span class="key">client</span>:
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://${EUREKA_USERNAME}:${EUREKA_PASSWORD}@localhost:8761</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example externalizes configuration of the username and password Eureka to environment variables called <code>EUREKA_USERNAME</code> and <code>EUREKA_PASSWORD</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eureka_health_checks">Eureka Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like Consul, the <a href="../api/io/micronaut/discovery/eureka/registration/EurekaAutoRegistration.html">EurekaAutoRegistration</a> will send <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances with the <a href="../api/io/micronaut/health/HealthStatus.html">HealthStatus</a> of the Micronaut application to Eureka.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/health/monitor/HealthMonitorTask.html">HealthMonitorTask</a> will by default continuously monitor the <a href="../api/io/micronaut/health/HealthStatus.html">HealthStatus</a> of the application by running health checks and the <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> will be sent to Eureka.</p>
</div>
</div>
</div>


<h2 id="serviceDiscoveryKubernetes">8.2.3 Kubernetes Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryKubernetes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Kubernetes is a container runtime which has a whole bunch of features including integrated Service Discovery. The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#environment-variables">strategy for Service Discovery in Kubernetes</a> is pretty simple in that for each Pod, Kubernetes will expose environment variables in the format <code>[SERVICE_NAME]_SERVICE_HOST</code> and <code>[SERVICE_NAME]_SERVICE_PORT</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut features a <a href="../api/io/micronaut/discovery/kubernetes/KubernetesDiscoveryClient.html">KubernetesDiscoveryClient</a> that simply looks at the environment variables and translates those into the available services.</p>
</div>
<div class="paragraph">
<p>For example given a service exposed as <code>HELLO_WORLD_SERVICE_HOST</code> to your application, you can declare clients that will be automatically discovered using:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> <span class="class">HelloClient</span>{
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Kubernetes itself assumes responsibility for tasks such as health checks, load balancing and so on there is no need to send <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances and so on.</p>
</div>


<h2 id="clientSideLoadBalancing">8.3 Client Side Load Balancing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/clientSideLoadBalancing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When <a href="#serviceDiscovery">discovering services</a> from Consul, Eureka or other Service Discovery servers the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> will emits a list of available <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut by default will automatically perform Round Robin client-side load balancing using the servers in this list. This combined with <a href="#retry">Retry Advice</a> adds extra resiliency to your Microservice infrastructure.</p>
</div>
<div class="paragraph">
<p>The load balancing itself is handled by the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> interface which defines a  <a href="../api/io/micronaut/http/client/LoadBalancer.html#select--">LoadBalancer.select()</a> method that returns a <code>Publisher</code> that emits a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> is returned because the process for selecting a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> may result in a network operation depending on the <a href="#serviceDiscovery">Service Discovery</a> strategy employed.</p>
</div>
<div class="paragraph">
<p>The default implementation of the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> interface is <a href="../api/io/micronaut/http/client/loadbalance/DiscoveryClientRoundRobinLoadBalancer.html">DiscoveryClientRoundRobinLoadBalancer</a>. You can replace this strategy for another implementation if you wish to customize how client side load balancing is handled in Micronaut since there are many different ways you may wish to optimize load balancing.</p>
</div>
<div class="paragraph">
<p>For example, you may wish to load balance between services in a particular zone or you may wish to load balance between servers that have the best overall response time.</p>
</div>
<div class="paragraph">
<p>To replace the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> used you should define a bean that <a href="#replaces">replaces</a> the <a href="../api/io/micronaut/http/client/loadbalance/DiscoveryClientLoadBalancerFactory.html">DiscoveryClientLoadBalancerFactory</a>.</p>
</div>
<div class="paragraph">
<p>In fact that is exactly what the Netflix Ribbon support does, described in the next section.</p>
</div>


<h2 id="netflixRibbon">8.3.1 Netflix Ribbon Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/clientSideLoadBalancing/netflixRibbon.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/Netflix/ribbon">Netflix Ribbon</a> is a inter process communication library used at Netflix that has support for customizable load balancing strategies.</p>
</div>
<div class="paragraph">
<p>If you need more flexibility in how your application performs client-side load balancing then you may wish use Micronaut&#8217;s Netflix Ribbon support.</p>
</div>
<div class="paragraph">
<p>To add Ribbon support to your application add the <code>netflix-ribbon</code> configuration to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:netflix-ribbon</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> implementations will now be <a href="../api/io/micronaut/configurations/ribbon/RibbonLoadBalancer.html">RibbonLoadBalancer</a> instances.</p>
</div>
<div class="paragraph">
<p>Ribbon&#8217;s <a href="http://netflix.github.io/ribbon/ribbon-core-javadoc/com/netflix/client/config/CommonClientConfigKey.html">Configuration options</a> can be set using the <code>ribbon</code> namespace in configuration. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Ribbon</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">ribbon</span>:
    <span class="key">VipAddress</span>: <span class="string"><span class="content">test</span></span>
    <span class="key">ServerListRefreshInterval</span>: <span class="string"><span class="content">2000</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each discovered client can also be configured under <code>ribbon.clients</code>. For example given a <code>@Client(id = "hello-world")</code> you can configure Ribbon settings with:</p>
</div>
<div class="listingblock">
<div class="title">Per Client Ribbon Settings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">ribbon</span>:
    <span class="key">clients</span>:
        <span class="key">hello-world</span>:
            <span class="key">VipAddress</span>: <span class="string"><span class="content">test</span></span>
            <span class="key">ServerListRefreshInterval</span>: <span class="string"><span class="content">2000</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Micronaut registers a <a href="../api/io/micronaut/configurations/ribbon/DiscoveryClientServerList.html">DiscoveryClientServerList</a> for each client that integrates Ribbon with Micronaut&#8217;s <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a>.</p>
</div>


<h2 id="distributedTracing">8.4 Distributed Tracing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/distributedTracing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When operating Microservices in production it can be challenging to troubleshoot interactions between Microservices in a distributed architecture.</p>
</div>
<div class="paragraph">
<p>To solve this problem a way to visualize interactions between Microservices in a distributed manner can be critical. Currently, there are various distributed tracing solutions, the most popular of which are <a href="https://zipkin.io">Zipkin</a> and <a href="https://www.jaegertracing.io/">Jaeger</a> both of which provide different levels of support for the <a href="http://opentracing.io">Open Tracing</a> API.</p>
</div>
<div class="paragraph">
<p>Micronaut features integration with both Zipkin and Jaeger (via the Open Tracing API).</p>
</div>
<div class="paragraph">
<p>To enable tracing you should add the <code>tracing</code> module to your <code>build.gradle</code> or <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:tracing</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_tracing_annotations">Tracing Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/tracing/annotation/package-summary.html">io.micronaut.tracing.annotation</a> package contains annotations that can be declared on methods to create new spans or continue existing spans.</p>
</div>
<div class="paragraph">
<p>The available annotations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/NewSpan.html">@NewSpan</a> annotation will create a new span, wrapping the method call or reactive type.</p>
</li>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/ContinueSpan.html">@ContinueSpan</a> annotation will continue an existing span, wrapping the method call or reactive type.</p>
</li>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/SpanTag.html">@SpanTag</a> annotation can be used on method arguments to include the value of each argument within a Span&#8217;s tags</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following snippet presents an example of using the annotations:</p>
</div>
<div class="listingblock">
<div class="title">Using Trace Annotations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">HelloService</span> {

    <span class="annotation">@NewSpan</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@SpanTag</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">person.name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> greet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name);
    }

    <span class="annotation">@ContinueSpan</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> greet(<span class="annotation">@SpanTag</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello.greeting</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> greet) {
        <span class="keyword">return</span> greeting;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/tracing/annotation/NewSpan.html">@NewSpan</a> annotation is used to start a new span</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <a href="../api/io/micronaut/tracing/annotation/SpanTag.html">@SpanTag</a> to include arguments of methods as tags for the span</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/tracing/annotation/ContinueSpan.html">@ContinueSpan</a> annotation can be used to continue as existing span and incorporate additional tags using <code>@SpanTag</code></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_tracing_instrumentation">Tracing Instrumentation</h3>
<div class="paragraph">
<p>In addition to explicit tracing tags, Micronaut includes a number of instrumentations to ensure that the Span context is propagated between threads and across Microservice boundaries.</p>
</div>
<div class="paragraph">
<p>These instrumentations are found in the <a href="../api/io/micronaut/tracing/instrument/package-summary.html">io.micronaut.tracing.instrument</a> package and include HTTP <a href="#clientFilter">Client Filters</a> and <a href="#filters">Server Filters</a> to propagate the necessary headers via HTTP.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tracing_beans">Tracing Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the Tracing annotations and existing instrumentations are not enough, Micronaut&#8217;s tracing integration registers a <code>io.opentracing.Tracer</code> bean that can be injected into any class and exposes the Open Tracing API.</p>
</div>
<div class="paragraph">
<p>Depending on the implementation you choose there are also additional beans. For example for Zipkin <code>brave.Tracing</code> and <code>brave.SpanCustomizer</code> beans are available too.</p>
</div>
</div>
</div>


<h2 id="zipkin">8.4.1 Tracing with Zipkin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/distributedTracing/zipkin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://zipkin.io">Zipkin</a> is a distributed tracing system. It helps gather timing data needed to troubleshoot latency problems in microservice architectures. It manages both the collection and lookup of this data.</p>
</div>
<div class="sect1">
<h2 id="_running_zipkin">Running Zipkin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to get up and started with Zipkin is with Docker:</p>
</div>
<div class="listingblock">
<div class="title">Running Zipkin with Docker</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run -d -p 9411:9411 openzipkin/zipkin</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then open a browser tab to the location <code><a href="http://localhost:9411" class="bare">http://localhost:9411</a></code> to view traces.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_traces_to_zipkin">Sending Traces to Zipkin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To send tracing spans to Zipkin the minimal configuration requires you add the following dependencies to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Adding Zipkin Dependencies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">runtime <span class="string"><span class="delimiter">'</span><span class="content">io.zipkin.brave:brave-instrumentation-http:4.19.0</span><span class="delimiter">'</span></span>
runtime <span class="string"><span class="delimiter">'</span><span class="content">io.zipkin.reporter2:zipkin-reporter:2.5.0</span><span class="delimiter">'</span></span>
compile <span class="string"><span class="delimiter">'</span><span class="content">io.opentracing.brave:brave-opentracing:0.30.0</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to enable ZipKin tracing in your configuration (potentially only your production configuration):</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">zipkin</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Or alternatively if you have the Micronaut CLI installed you can configure Zipkin when creating your service with: <code>mn create-app hello-world -features tracing-zipkin</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_zipkin_sender">Customizing the Zipkin Sender</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default an <a href="../api/io/micronaut/tracing/brave/sender/HttpClientSender.html">HttpClientSender</a> that sends Spans asynchronously using Micronaut&#8217;s native HTTP client to <code><a href="http://localhost:9411/api/v2/spans" class="bare">http://localhost:9411/api/v2/spans</a></code> will be configured.</p>
</div>
<div class="paragraph">
<p>It is unlikely that sending spans to localhost will be suitable for production deployment so you generally will want to configure the location of one or many Zipkin servers for production:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Multiple Zipkin Servers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">zipkin</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">urls</span>:
            - <span class="string"><span class="content">http://foo:9411</span></span>
            - <span class="string"><span class="content">http://bar:9411</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In production, setting <code>TRACING_ZIPKIN_URLS</code> environment variable with a comma separated list of URLs will also work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively if you wish to use a different <code>zipkin2.reporter.Sender</code> implementation, you can simply define a bean that is of type <code>zipkin2.reporter.Sender</code> and it will be picked up.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zipkin_configuration">Zipkin Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many configuration options available for the Brave client that sends Spans to Zipkin and they are generally exposed via the <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> class. You can refer to the javadoc for all the available options.</p>
</div>
<div class="paragraph">
<p>Below is an example of customizing Zipkin configuration:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Zipkin Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">zipkin</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">traceId128Bit</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">sampler</span>:
            <span class="key">probability</span>: <span class="string"><span class="content">1</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also optionally dependency inject common configuration classes into <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> such as <code>brave.sampler.Sampler</code> just by defining them as beans. See the API for <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> for available injection points.</p>
</div>
</div>
</div>


<h2 id="jaeger">8.4.2 Tracing with Jaeger</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/distributedTracing/jaeger.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.jaegertracing.io">Jaeger</a> is another distributed tracing system developed at Uber that is more or less the reference implementation for <a href="http://opentracing.io">Open Tracing</a>.</p>
</div>
<div class="sect1">
<h2 id="_running_jaeger">Running Jaeger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The easiest way to get started with Jaeger is to run Jaeger via Docker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run -d -e \
  COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then navigate to <code><a href="http://localhost:16686" class="bare">http://localhost:16686</a></code> to access the Jaeger UI.</p>
</div>
<div class="paragraph">
<p>See <a href="https://www.jaegertracing.io/docs/getting-started/">Getting Started with Jaeger</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_traces_to_jaeger">Sending Traces to Jaeger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To send tracing spans to Jaeger the minimal configuration requires you add the following dependencies to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Adding Jaeger Dependencies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">io.jaegertracing:jaeger-core:0.27.0</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to enable Jaeger tracing in your configuration (potentially only your production configuration):</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">jaeger</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Jaeger will be configured to send traces to a locally running Jaeger agent.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Or alternatively if you have the Micronaut CLI installed you can configure Zipkin when creating your service with: <code>mn create-app hello-world -features tracing-jaeger</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jaeger_configuration">Jaeger Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many configuration options available for the Jaeger client that sends Spans to Jaeger and they are generally exposed via the <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> class. You can refer to the javadoc for all the available options.</p>
</div>
<div class="paragraph">
<p>Below is an example of customizing JaegerConfiguration configuration:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Zipkin Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">jaeger</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">sampler</span>:
            <span class="key">probability</span>: <span class="string"><span class="content">0.5</span></span>
        <span class="key">sender</span>:
            <span class="key">agentHost</span>: <span class="string"><span class="content">foo</span></span>
            <span class="key">agentPort</span>: <span class="string"><span class="content">5775</span></span>
        <span class="key">reporter</span>:
            <span class="key">flushInterval</span>: <span class="string"><span class="content">2000</span></span>
            <span class="key">maxQueueSize</span>: <span class="string"><span class="content">200</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also optionally dependency inject common configuration classes into <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> such as <code>io.jaegertracing.Configuration.SamplerConfiguration</code> just by defining them as beans. See the API for <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> for available injection points.</p>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/httpClient.html">&lt;&lt; <strong>7</strong><span>The HTTP Client</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
